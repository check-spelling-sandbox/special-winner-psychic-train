

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml">

      <meta charset="utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
      <title>10.8.&nbsp;Statistics and execution plans - Chapter&nbsp;10.&nbsp;Performance</title>
      <link rel="stylesheet" type="text/css" href="../../docbook.css"></link>
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,300italic"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/codemirror.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/theme/neo.min.css"></link>
      <link rel="stylesheet" type="text/css" href="../../css/extra.css"></link>
      <link rel="stylesheet" type="text/css" href="../../css/chunked-base.css"></link><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/codemirror.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/addon/runmode/runmode.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/javascript/javascript.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/shell/shell.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/powershell/powershell.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/python/python.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/xml/xml.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/clike/clike.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/cypher/cypher.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/properties/properties.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/groovy/groovy.min.js" type="text/javascript"></script><script src="../../javascript/colorize.js" type="text/javascript"></script><script src="../../javascript/tabs-for-chunked.js" type="text/javascript"></script><script src="../../javascript/mp-nav.js" type="text/javascript"></script><script src="../../javascript/versionswitcher.js" type="text/javascript"></script><script src="../../javascript/version.js" type="text/javascript"></script><script src="https://s3-eu-west-1.amazonaws.com/alpha.neohq.net/docs/new-manual/assets/search.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"></meta>
      <meta name="description" content="This section describes the configuration options that affect the gathering of statistics, and the replanning of query plans in the Cypher query engine."></meta>
      <link rel="prev" href="../../performance/disks-ram-and-other-tips/" title="10.7. Disks, RAM and other tips"></link>
      <link rel="next" href="../../tools/" title="Chapter 11. Tools"></link>
      <link rel="shortcut icon" href="../../wp-content/themes/neo4jweb/favicon.ico"></link><script>
        $(document).ready(function() {
          CodeMirror.colorize();
          tabTheSource($('body'));
          var $header = $('header').first();
          $header.prepend(
            $('<a href="../../" id="logo"><img src="../../wp-content/themes/neo4jweb/assets/images/neo4j-logo-2015.png" alt="Neo4j Logo"></img></a>')
          );
          var $sidebar = $('<div id="sidebar-wrapper"></div>');
          $.get('toc.html', function (d){
            $(d).appendTo($sidebar);
            highlightToc();
            highlightLibraryHeader();
          });
          $sidebar.insertAfter($('header').first());
        });
        </script></head>
 
      <header>
         <div class="searchbox">
            <form id="search-form" class="search" name="search-form" role="search"><input id="search-form-input" name="q" title="search" type="search" lang="en" placeholder="Search Neo4j docs..." aria-label="Search Neo4j documentation" max-length="128" required="required"></input><input id="search-form-button" type="submit" value="Search"></input></form>
         </div>
         <ul class="documentation-library">
            <li><a href="../../">Operations Manual</a></li>
            <li><a href="../../docs/developer-manual/3.4/">Developer Manual</a></li>
            <li><a href="../../docs/ogm-manual/3.0/">OGM Manual</a></li>
            <li><a href="../../docs/graph-algorithms/3.4/">Graph Algorithms</a></li>
            <li><a href="../../docs/java-reference/3.4/">Java Reference</a></li>
         </ul>
         <nav id="header-nav"><span class="nav-previous"><a accesskey="p" href="../../performance/disks-ram-and-other-tips/"><span class="fa fa-long-arrow-left" aria-hidden="true"></span>Disks, RAM and other tips</a></span><span class="nav-current">
               <p class="nav-title hidden">10.8.&nbsp;Statistics and execution plans</p></span><span class="nav-next"><a accesskey="n" href="../../tools/">Tools<span class="fa fa-long-arrow-right" aria-hidden="true"></span></a></span></nav>
      </header>
      <div id="search-results" class="hidden"></div>
      <section class="section" id="statistics-execution-plans">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a class="anchor" href="#statistics-execution-plans"></a>10.8.&nbsp;Statistics and execution plans
                  </h2>
               </div>
            </div>
         </div>
         <div class="abstract">
            <p>This section describes the configuration options that affect the gathering of statistics, and the replanning of query plans
               in the Cypher query engine.
            </p>
         </div>
         <p>When a Cypher query is issued, it gets compiled to an execution plan that can run and answer the query.
            The Cypher query engine uses available information about the database, such as schema information about which indexes and
            constraints exist in the database.
            Neo4j also uses statistical information about the database to optimize the execution plan.
         </p>
         <p>For further details, please see <span class="olink">Developer Manual &#8594; Query tuning</span> and <span class="olink">Developer Manual &#8594; Execution plans</span>.
         </p>
         <p>The frequency of statistics gathering and the replanning of execution plans are described in the sections below.</p>
         <section class="section" id="_statistics">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="#_statistics"></a>10.8.1.&nbsp;Statistics
                     </h3>
                  </div>
               </div>
            </div>
            <p>The statistical information that Neo4j keeps is:</p>
            <div class="orderedlist">
               <ol class="orderedlist" type="1">
                  <li class="listitem">The number of nodes having a certain label.</li>
                  <li class="listitem">The number of relationships by type.</li>
                  <li class="listitem">The number of relationships by type, ending or starting from a node with a specific label.</li>
                  <li class="listitem">Selectivity per index.</li>
               </ol>
            </div>
            <p>Neo4j keeps the statistics up to date in two different ways.
               For label and relationship counts, the number is updated whenever you set or remove a label from a node.
               For indexes, however, Neo4j needs to scan the full index to produce the selectivity number.
               Since this is potentially a very time-consuming operation, these numbers are collected in the background when enough data
               on the index has been changed.
            </p>
            <p>The following settings allow you to control whether statistics are collected automatically, and at which rate:</p>
            <div class="informaltable">
               <div class="table" id="d0e19929">
                  <table class="informaltable" border="1">
                     <colgroup>
                        <col class="col_1"></col>
                        <col class="col_2"></col>
                        <col class="col_3"></col>
                     </colgroup>
                     <thead>
                        <tr>
                           <th style="text-align: left; vertical-align: top; ">Parameter name</th>
                           <th style="text-align: left; vertical-align: top; ">Default value</th>
                           <th style="text-align: left; vertical-align: top; ">Description</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal"><a class="link" href="../../reference/configuration-settings/#config_dbms.index_sampling.background_enabled" title="Table A.125. dbms.index_sampling.background_enabled">dbms.index_sampling.background_enabled</a></code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal">true</code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p>Controls whether indexes will automatically be re-sampled when they have been updated enough.
                                 The Cypher query planner depends on accurate statistics to create efficient plans, so it is important it is kept up to date
                                 as the database evolves.
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal"><a class="link" href="../../reference/configuration-settings/#config_dbms.index_sampling.update_percentage" title="Table A.128. dbms.index_sampling.update_percentage">dbms.index_sampling.update_percentage</a></code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal">5</code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p>Controls the percentage of the index that has to have been updated before a new sampling run is triggered.</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
            <p>It is possible to manually trigger index sampling, using the following built-in procedures:</p>
            <div class="variablelist">
               <dl class="variablelist">
                  <dt><span class="term"><code class="literal">db.resampleIndex()</code></span></dt>
                  <dd>Trigger resampling of an index.</dd>
                  <dt><span class="term"><code class="literal">db.resampleOutdatedIndexes()</code></span></dt>
                  <dd>Trigger resampling of all outdated indexes.</dd>
               </dl>
            </div>
            <div class="example" id="d0e19986">
               <div class="example-title">Example&nbsp;10.5.&nbsp;Manually trigger index resampling</div>
               <div class="example-contents">
                  <p>The following example illustrates how to trigger a resampling of the index on the label <code class="literal">Person</code> and property <code class="literal">name</code>, by calling <code class="literal">db.resampleIndex()</code>:
                  </p><pre class="screen highlight"><code>CALL db.resampleIndex(":Person(name)");</code></pre><p>The following example illustrates how to call <code class="literal">db.resampleOutdatedIndexes()</code> in order to trigger a resampling of all outdated indexes:
                  </p><pre class="screen highlight"><code>CALL db.resampleOutdatedIndexes();</code></pre></div>
            </div>
         </section>
         <section class="section" id="_execution_plans">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="#_execution_plans"></a>10.8.2.&nbsp;Execution plans
                     </h3>
                  </div>
               </div>
            </div>
            <p>Execution plans are cached and will not be replanned until the statistical information used to produce the plan has changed.
               The following setting enables you to control how sensitive replanning should be to updates of the database:
            </p>
            <div class="informaltable">
               <div class="table" id="d0e20014">
                  <table class="informaltable" border="1">
                     <colgroup>
                        <col class="col_1"></col>
                        <col class="col_2"></col>
                        <col class="col_3"></col>
                     </colgroup>
                     <thead>
                        <tr>
                           <th style="text-align: left; vertical-align: top; ">Parameter name</th>
                           <th style="text-align: left; vertical-align: top; ">Default value</th>
                           <th style="text-align: left; vertical-align: top; ">Description</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal"><a class="link" href="../../reference/configuration-settings/#config_cypher.statistics_divergence_threshold" title="Table A.92. cypher.statistics_divergence_threshold">cypher.statistics_divergence_threshold</a></code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal">0.75</code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p>The threshold when a plan is considered stale.
                                 If any of the underlying statistics used to create the plan have changed more than this value, the plan will be considered
                                 stale and will be replanned.
                                 Change is calculated as <code class="literal">abs(a-b)/max(a,b)</code>.
                                 This means that a value of <code class="literal">0.75</code> requires the database to approximately quadruple in size before replanning occurs.
                                 A value of 0 means replan as soon as possible, with the soonest being defined by the parameter <code class="literal"><a class="link" href="../../reference/configuration-settings/#config_cypher.min_replan_interval" title="Table A.90. cypher.min_replan_interval">cypher.min_replan_interval</a></code>, which defaults to 10s.
                                 After this interval the divergence threshold will slowly start to decline, reaching 10% after about 7h.
                                 This will ensure that long-running databases will still get query replanning on even modest changes, while not replanning
                                 frequently unless the changes are very large.
                              </p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
         </section>
      </section>
      <footer><script type="text/javascript">
        </script><script type="text/javascript">
        </script><script>;</script></footer>
   </body>
</html><!--
     FILE ARCHIVED ON 16:42:31 Apr 17, 2024 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 15:41:18 Jul 04, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
-->